<!-- 分类授权编辑页面 -->
<extend name="Public/base" />

<!-- 子导航 -->
<block name="sidebar">
    <include file="Public/sidemenu"/>
</block>

<block name="content">
    <!-- 标题栏 -->
    <div class="ell-main-title">
        <h2>权限管理</h2>
    </div>

    <div class="tab-wrap">
        <div class="row">
            <div class="col-md-9">
                <ul class="nav nav-tabs" role="tablist">
                    <li><a href="{:U('AuthManager/access',array('group_name'=>I('group_name') ,'group_id'=> I('group_id')))}">访问授权</a></li>
                    <li class="active"><a href="javascript:;">分类授权</a></li>
                    <li><a href="{:U('AuthManager/user',array('group_name'=>I('group_name') ,'group_id'=> I('group_id')))}">成员授权</a></li>
                </ul>
            </div>
            <div class="col-md-3">
                <select class="form-control" name="group">
                    <volist name="auth_group" id="vo">
                    <option value="{:U('AuthManager/category',array('group_id'=>$vo['id'],'group_name'=>$vo['title']))}" <eq name="vo['id']" value="$this_group['id']">selected</eq>>
                        {$vo.title}
                    </option>
                    </volist>
                </select>
            </div>
        </div>
        <!-- 表格列表 -->
        <div class="tb-unit">
            <form class="save-category" action="{:U('AuthManager/addToCategory')}" method="post" enctype="application/x-www-form-urlencoded">
                <input type="hidden" name="group_id" value="{:I('group_id')}">
                <div class="category auth-category">
                    <div class="hd clearfix">
                        <div class="fold">折叠</div>
                        <div class="order">选择</div>
                        <div class="name">栏目名称</div>
                    </div>
                    {:R('AuthManager/tree', array($group_list))}
                </div>

                <div class="tb-unit-bar">
                    <button class="btn btn-success ajax-post" type="submit" target-form="save-category">确 定</button>
                    <button class="btn btn-danger" onclick="javascript:history.back(-1);return false;">返 回</button>
                </div>
            </form>
        </div>
    </div>
<!-- /表格列表 -->
</block>
<block name="script">
<script type="text/javascript">
    $(function(){
        /* 分类展开收起 */
        $(".category dd").prev().find(".fold i").addClass("icon-unfold")
            .click(function(){
                var self = $(this);
                if(self.hasClass("icon-unfold")){
                    self.closest("dt").next().slideUp("fast", function(){
                        self.removeClass("icon-unfold").addClass("icon-fold");
                    });
                } else {
                    self.closest("dt").next().slideDown("fast", function(){
                        self.removeClass("icon-fold").addClass("icon-unfold");
                    });
                }
            });

        var auth_groups = [{$authed_group}];
        $('.cate_id').each(function(){
            if( $.inArray( parseInt(this.value,10),auth_groups )>-1 ){
                $(this).prop('checked',true);
            }
        });
        $('select[name=group]').change(function(){
            location.href = this.value;
        });
    });
</script>
</block>
