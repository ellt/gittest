<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <title>登录 |e朗朗</title>
        <link href="__BS__/css/bootstrap.css" rel="stylesheet">
        <link href="__STATIC__/font-awesome/css/font-awesome.min.css" rel="stylesheet">
        <link href="__CSS__/login.css" rel="stylesheet">
    </head>
    <body>
        <div class="container-fluid login-bg">

            <!-- 主体 -->
            <div class="row">
                <div class="col-xs-12 col-sm-9 col-sm-offset-3 login-body">
                    <div class="row">
                        <div class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-1 col-lg-4 col-lg-offset-2 login-main">
                            <form class="form-horizontal" action="{:U('login')}" method="post">
                                <h1><strong>e朗朗校园平台</strong></h1>
                                <div class="form-group has-feedback">
                                    <label class="sr-only" for="username">账号</label>
                                    <div class="col-xs-12">
                                        <input type="text" class="form-control input-lg" id="username" name="username" data-container="body" data-toggle="popover" data-placement="top" data-trigger="focus" placeholder="教师工号">
                                        <span class="form-control-feedback"></span>
                                    </div>
                                </div>
                                <div class="form-group has-feedback">
                                    <label class="sr-only" for="password">密码</label>
                                    <div class="col-xs-12">
                                        <input type="password" class="form-control input-lg" id="password" name="password" data-container="body" data-toggle="popover" data-placement="top" data-trigger="focus" placeholder="密码" autocomplete="off">
                                        <span class="form-control-feedback"></span>
                                    </div>
                                </div>
<!--                                 <div class="form-group hidden">
                                    <label class="sr-only" for="verify">验证码</label>
                                    <input type="text" class="form-control input-lg login-verify" id="verify" name="verify" placeholder="验证码" autocomplete="off">
                                </div>
                                <div class="form-group hidden">
                                    <img class="verifyimg reloadverify" alt="点击切换" src="{:U('Public/verify')}">
                                    <a class="reloadverify" title="换一张" href="javascript:void(0)">换一张</a>
                                </div> -->
                                <div class="form-group">
                                    <div class="col-xs-12">
                                        <button type="submit" class="btn btn-primary btn-lg btn-block" data-loading-text="登录中..." autocomplete="off">立即登录</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="__BS__/js/html5shiv.min.js"></script>
        <script src="__BS__/js/respond.min.js"></script>
        <![endif]-->
        <script src="__STATIC__/jquery.min.js"></script>
        <script src="__BS__/js/bootstrap.min.js"></script>
        <script type="text/javascript">
        $(function(){
            //初始化选中用户名输入框
            $("#username").focus();
            $('[data-toggle="popover"]').popover();
            //表单提交
            $("form").submit(function(e) {
                e.preventDefault();

                var form = $(this);
                var btn = $("button:submit");
                btn.button('loading');
                $.post(form.attr("action"), form.serialize()).success(function(data){
                    btn.button('reset');
                    if (data.status) {
                        showLoginTip(form);
                        window.location.href = data.url;
                    } else {
                        showLoginTip(form, data.hint);
                        //刷新验证码
                        //$(".reloadverify").click();
                    }
                });
            });

            //刷新验证码
            var verifyimg = $(".verifyimg").attr("src");
            $(".reloadverify").click(function(){
                if( verifyimg.indexOf('?')>0){
                    $(".verifyimg").attr("src", verifyimg+'&random='+Math.random());
                }else{
                    $(".verifyimg").attr("src", verifyimg.replace(/\?.*$/,'')+'?'+Math.random());
                }
            });

            function showLoginTip(form, data) {
                $("input", form).each(function(index){
                    inputName = $(this).attr("name");
                    var row = $(this).parents(".form-group");
                    tipIcon = row.find('.form-control-feedback');

                    // 显示提示
                    if (data && data[inputName]) {
                        $(this).attr('data-content', data[inputName].errorInfo);
                        $(this).focus();
                        row.addClass("has-error");
                        tipIcon.addClass("glyphicon glyphicon-remove");
                         
                    } else {
                        $(this).attr('data-content', "");
                        row.removeClass("has-error");
                        tipIcon.removeClass("glyphicon glyphicon-remove");
                    }
                });
            }
        });
        </script>
    </body>
</html>
