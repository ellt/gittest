<div class="modal" id="finishModal" tabindex="-1" role="dialog" aria-labelledby="finishLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">关闭</span>
                </button>
                <h4 class="modal-title" id="finishLabel">提示</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-2 text-center">
                        <p data-id="modal-icon"></p>
                    </div>
                    <div class="col-md-10">
                        <p data-id="modal-msg"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary" data-submit="custom" data-url="{:U('finish')}" data-loading-text="进入中..." autocomplete="off">确定</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>

<script>
$(function(){

    // 初始化
    var $modal = $("#finishModal");
    var $icon  = $("[data-id='modal-icon']", $modal);
    var $msg   = $("[data-id='modal-msg']", $modal);

    $modal.on('show.bs.modal', function (e) {
        // 过滤非modal触发的事件，如datatimepicker产生的事件
        if(e.relatedTarget === undefined) {
            return e.preventDefault(); // 阻止模态框的展示
        }

        var info = $(e.relatedTarget).data("info");
        
        if (info.state !== "t4") {
            $icon.html("<i class='fa fa-warning fa-4x text-warning'></i>");
            $msg.html("还未到学年结束时间，确定要结束 " + info.current + "学年，并进入 " + info.next + " 学年设置吗？");
        } else {
            $icon.html("<i class='fa fa-info-circle fa-4x text-primary'></i>");
            $msg.html("确定要结束 " + info.current + " 学年，并进入 " + info.next + " 学年设置吗？");
        }
    });

    $("[data-submit='custom']", $modal).click(function(e) { 
        //取消默认动作
        e.preventDefault();

        var url = $(this).data('url');
        var btn = $(this);
        btn.button('loading');
        //发送到服务器
        $.post(url, {}).success(function(data){
            btn.button('reset');
            $modal.modal('hide');
            handleAjax(data);
        });
    });
});
</script>